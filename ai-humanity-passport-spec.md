# Project Spec: **Humanity Passport**

## 1. Project Overview

**Humanity Passport** is a Next.js web application that evaluates GitHub
repositories and issues them a "Humanity Passport" --- a badge of honor
indicating whether the project contributes positively to humanity.
Developers can embed the badge in their repo's `README.md`. Clicking the
badge links back to a detailed analysis page, which includes a verdict,
strengths, potential weaknesses, and reasoning generated by an LLM.
Å
The goal: encourage socially responsible software, celebrate good
projects, and make the "good for humanity" credential playful and
visible.

------------------------------------------------------------------------

## 2. Core Features

### a. Repo Submission

-   Input: GitHub repo URL (e.g., `https://github.com/vercel/next.js`).
-   Validation: Parse `owner/repo` pattern.
-   Fetch metadata from GitHub API (description, stars, topics, README).
-   Queue analysis request.

### b. LLM Analysis

-   Uses **Groq** with the **gpt-oss-20b** model.
-   Prompt includes repo metadata (name, description, stars, topics, top
    README content).
-   Output structured into:
    -   **Verdict**: `"approved"` (positive impact) or `"rejected"`.
    -   **Details**: explanation of strengths, good impact, and possible
        weak points.

### c. Badge Generation

-   API endpoint serves **dynamic SVG** badge.
-   Badge reflects verdict:
    -   ✅ Approved → green "Humanity+ Passport"
    -   ❌ Rejected → red "Not Approved"
-   Badge includes link back to a **Passport page**.

### d. Passport Page

-   Displays repo name, badge, verdict, and detailed analysis.

-   Publicly accessible at `/passport/[owner]/[repo]`.

-   Shows copy-paste Markdown snippet for embedding badge:

    ``` md
    [![Humanity Passport](https://yourdomain.com/api/badge/OWNER/REPO)](https://yourdomain.com/passport/OWNER/REPO)
    ```

### e. Persistence

-   Store analyses in **SQLite via Prisma**.

-   Schema:

    ``` prisma
    model Analysis {
      id        Int      @id @default(autoincrement())
      owner     String
      repo      String
      verdict   String
      details   String
      createdAt DateTime @default(now())

      @@unique([owner, repo])
    }
    ```

-   Ensures repeat submissions for same repo update existing record
    instead of duplicating.

------------------------------------------------------------------------

## 3. Tech Stack

-   **Frontend**: Next.js 14 (App Router), React, TailwindCSS,
    shadcn/ui.
-   **Backend**:
    -   Next.js API routes (`app/api/*`).
    -   Groq SDK (for LLM).
    -   Octokit (GitHub API client).
-   **Database**: SQLite + Prisma ORM.
-   **Hosting**: Vercel (or any Next.js-compatible host).
-   **Auth** (optional, future): GitHub OAuth for "verified" repo
    submissions.

------------------------------------------------------------------------

## 4. API Endpoints

### `POST /api/analyze`

-   Input: `{ repoUrl: string }`

-   Output:

    ``` json
    {
      "owner": "vercel",
      "repo": "next.js",
      "verdict": "approved",
      "details": "This repo is..."
    }
    ```

-   Behavior:

    -   Fetch repo metadata.
    -   Run LLM analysis.
    -   Upsert result in DB.

### `GET /api/badge/[owner]/[repo]`

-   Returns **SVG badge** based on stored analysis.
-   Example response:\
    ![Humanity Badge
    Example](https://img.shields.io/badge/Humanity%2B-Passport-green)

### `GET /passport/[owner]/[repo]`

-   Renders repo's Passport page (human-readable).
-   Pulls analysis from DB.
-   Includes copy-paste badge Markdown snippet for README badge.

------------------------------------------------------------------------

## 5. User Flows

### Flow 1: Repo Submission

1.  User enters GitHub repo URL in input box.
2.  Backend fetches metadata → sends to Groq → receives analysis.
3.  Verdict + details stored in DB.
4.  User sees confirmation page with badge + Passport link.
5.  User copies Markdown snippet into their README.

### Flow 2: Badge Click

1.  Visitor clicks badge in a repo's README.
2.  Redirects to `/passport/[owner]/[repo]`.
3.  Shows full analysis (verdict, strengths, weaknesses).

------------------------------------------------------------------------

## 6. UI Wireframe (high-level)

-   **Home Page**:
    -   Hero: "Get your Humanity Passport"
    -   Input: GitHub repo URL
    -   Button: "Analyze"
    -   Recent analyzed repos (optional, future).
-   **Passport Page**:
    -   Title: "Humanity Passport: owner/repo"
    -   Badge (big, centered).
    -   Verdict (green/red text).
    -   Analysis details.
    -   Copy-paste badge Markdown snippet.

------------------------------------------------------------------------

## 7. Prompt Design (LLM)

Prompt example for Groq:

    You are evaluating a GitHub project to see if it benefits humanity.

    Repository:
    - Name: vercel/next.js
    - Description: The React Framework
    - Stars: 120k
    - Topics: react, javascript, framework

    Task:
    1. Decide if this project should be APPROVED (good for humanity) or REJECTED.
    2. Provide a short explanation of its strengths and positive impact.
    3. Note any potential weaknesses or concerns.

    Respond clearly. Use "Verdict: APPROVED" or "Verdict: REJECTED" in your answer.

------------------------------------------------------------------------

## 8. Security Considerations

-   Validate repo URL before fetching.
-   Rate-limit submissions to prevent abuse.
-   Sanitize LLM output before rendering (avoid unsafe HTML).

------------------------------------------------------------------------

## 9. Future Enhancements

-   **Leaderboard**: Showcase all approved repos ("Hall of Humanity").
-   **GitHub Action**: Auto-generate Humanity Passport on PR merge.
-   **Community Votes**: Let users vote on whether repos are beneficial.
-   **Granular Badges**: Categories like "Education+", "Climate+", etc.

------------------------------------------------------------------------

## 10. Success Criteria

-   User can input a GitHub repo and get an **analysis + badge** within
    \~10 seconds.
-   Badge is **copy-pasteable** into a README and works immediately.
-   Passport page is **publicly viewable** and styled cleanly.
-   Database ensures analyses persist and are unique per repo.
